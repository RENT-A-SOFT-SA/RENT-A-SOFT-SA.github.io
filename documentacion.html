<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centro de Documentación | RENT-A-SOFT-SA</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="docs-body">
    <header class="docs-header">
        <div class="docs-brand">
            <span class="brand-accent"></span>
            <div>
                <p class="brand-label">RENT-A-SOFT-SA</p>
                <h1 class="brand-title">Centro de Documentación</h1>
            </div>
        </div>
        <nav class="docs-nav">
            <a href="index.html">Inicio</a>
        </nav>
    </header>

    <main class="docs-layout">
        <aside class="docs-sidebar" aria-label="Listado de productos y APIs">
            <div class="sidebar-intro">
                <h2>Biblioteca técnica</h2>
                <p>Explora nuestras APIs organizadas por producto y accede a su documentación oficial.</p>
            </div>
            <div id="docs-catalog" class="catalog"></div>
        </aside>

        <section class="docs-viewer" aria-label="Visor de documentación">
            <div class="viewer-toolbar">
                <div>
                    <p class="viewer-label">Documento activo</p>
                    <h2 id="viewer-title">Selecciona una API para comenzar</h2>
                </div>
            </div>
            <div id="viewer-meta" class="viewer-meta"></div>
            <article id="doc-content" class="viewer-content">
                <p class="empty-state">Elige un elemento del listado para visualizar su documentación aquí.</p>
            </article>
        </section>
    </main>

    <footer class="docs-footer">
        <p>&copy; 2025 RENT-A-SOFT-SA. Documentación centralizada para equipos y partners.</p>
    </footer>

    <!-- Botón flotante scroll hacia arriba -->
    <button class="scroll-to-top" id="scrollToTop" title="Ir arriba">
        ↑
    </button>

    <script>
        // Funcionalidad del botón scroll hacia arriba
        const scrollToTopBtn = document.getElementById('scrollToTop');
        
        // Mostrar/ocultar botón según el scroll
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        });
        
        // Scroll suave hacia arriba al hacer click
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
    </script>

    <script>
        const documentationCatalog = [
            {
                product: 'MrTurno',
                description: 'Gestion de turnos, usuarios, pacientes y notificaciones.',
                apis: [
                    {
                        id: 'mrturno-api-desarrolladores',
                        name: 'API de Desarrolladores MrTurno 5',
                        summary: 'Documentación completa con autenticación JWT RS256, endpoints por módulo y flujos recomendados.',
                        format: 'md',
                        path: 'docs/mt_api_dev/mrturno-api-desarrolladores.md'
                    },
                    {
                        id: 'mrturno-notificaciones-multiples',
                        name: 'API Notificaciones Múltiples',
                        summary: 'Integración de recordatorios y confirmaciones de turnos vía notificaciones externas.',
                        format: 'md',
                        path: 'docs/mt_api_dev/api-dev-notificaciones-multiples-mrturno.md'
                    },
                ]
            }
            // Para agregar un nuevo producto, agrega aquí una nueva entrada:
            // {
            //     product: 'Mi Nuevo Producto',
            //     description: 'Descripción del producto.',
            //     apis: [
            //         {
            //             id: 'mi-api-docs',
            //             name: 'Documentación de Mi API',
            //             summary: 'Guía completa para integrar Mi API.',
            //             format: 'md',
            //             path: 'docs/mi_producto/guia.md'
            //         }
            //     ]
            // }
        ];

        const catalogContainer = document.getElementById('docs-catalog');
        const viewerTitle = document.getElementById('viewer-title');
        const viewerMeta = document.getElementById('viewer-meta');
        const docContent = document.getElementById('doc-content');
        let activeButton = null;

        function createCatalog() {
            documentationCatalog.forEach(group => {
                const section = document.createElement('section');
                section.className = 'catalog-group';

                const header = document.createElement('header');
                header.className = 'catalog-group__header';
                header.innerHTML = `
                    <h3>${group.product}</h3>
                    <p>${group.description}</p>
                `;
                section.appendChild(header);

                const list = document.createElement('div');
                list.className = 'catalog-group__items';

                group.apis.forEach(api => {
                    const button = document.createElement('button');
                    button.type = 'button';
                    button.className = 'catalog-item';
                    button.dataset.path = api.path;
                    button.dataset.format = api.format;
                    button.dataset.product = group.product;
                    button.dataset.name = api.name;
                    button.dataset.summary = api.summary;
                    button.dataset.id = api.id;
                    button.innerHTML = `
                        <span class="catalog-item__title">${api.name}</span>
                        <span class="catalog-item__summary">${api.summary}</span>
                        <span class="catalog-item__format">${api.format.toUpperCase()}</span>
                    `;
                    button.addEventListener('click', () => {
                        loadDocumentation(api, group.product, button);
                        updateQueryString(api.id);
                    });
                    list.appendChild(button);
                });

                section.appendChild(list);
                catalogContainer.appendChild(section);
            });
        }

        function updateQueryString(id) {
            const params = new URLSearchParams(window.location.search);
            params.set('doc', id);
            const query = params.toString();
            if (history.replaceState) {
                history.replaceState(null, '', `${window.location.pathname}?${query}`);
            }
        }

        function loadDocumentation(api, productName, buttonElement, isInitialLoad = false) {
            if (!isInitialLoad) {
                docContent.innerHTML = '<p class="loading">Cargando documentación…</p>';
            }
            viewerTitle.textContent = api.name;
            viewerMeta.innerHTML = `
                <span class="meta-item">${productName}</span>
                <span class="meta-item">Formato ${api.format.toUpperCase()}</span>
            `;

            fetch(api.path)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('No se pudo obtener el archivo solicitado.');
                    }
                    return response.text();
                })
                .then(rawContent => {
                    if (api.format === 'md' || api.path.endsWith('.md') || api.path.endsWith('.markdown')) {
                        // Configurar marked para generar IDs automáticamente en los encabezados
                        marked.setOptions({
                            headerIds: true,
                            mangle: false
                        });
                        docContent.innerHTML = marked.parse(rawContent);
                    } else {
                        const parser = new DOMParser();
                        const parsed = parser.parseFromString(rawContent, 'text/html');
                        docContent.innerHTML = parsed.body ? parsed.body.innerHTML : rawContent;
                    }
                })
                .catch(error => {
                    docContent.innerHTML = `<p class="error-state">${error.message}</p>`;
                });

            if (activeButton) {
                activeButton.classList.remove('catalog-item--active');
            }
            if (buttonElement) {
                buttonElement.classList.add('catalog-item--active');
                activeButton = buttonElement;
            }
        }

        function findApiById(id) {
            for (const group of documentationCatalog) {
                for (const api of group.apis) {
                    if (api.id === id) {
                        return { api, product: group.product };
                    }
                }
            }
            return null;
        }

        function handleInitialLoad() {
            const params = new URLSearchParams(window.location.search);
            const docId = params.get('doc');
            if (docId) {
                const match = findApiById(docId);
                if (match) {
                    const button = document.querySelector(`.catalog-item[data-id="${docId}"]`);
                    loadDocumentation(match.api, match.product, button, true);
                    if (button) {
                        button.classList.add('catalog-item--active');
                        activeButton = button;
                    }
                }
            } else {
                const firstGroup = documentationCatalog[0];
                if (firstGroup && firstGroup.apis.length) {
                    const firstApi = firstGroup.apis[0];
                    const button = document.querySelector(`.catalog-item[data-id="${firstApi.id}"]`);
                    loadDocumentation(firstApi, firstGroup.product, button, true);
                    if (button) {
                        button.classList.add('catalog-item--active');
                        activeButton = button;
                    }
                    updateQueryString(firstApi.id);
                }
            }
        }

        createCatalog();
        handleInitialLoad();
    </script>
</body>
</html>
